<!DOCTYPE html>
<html lang="">

<head>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
  <!-- MDB -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.0/mdb.min.css" rel="stylesheet" />
  <link rel="icon" type="image/svg" href="https://jole84.se/84.png" />
  <script src="https://jole84.se/filesList.js"></script>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta charset="utf-8">
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <title>jole84.se</title>
  <style>
    #linkButton,
    #linkButton2 {
      width: 50%;
    }

    #kartbild {
      height: 150px;
      overflow: hidden;
      white-space: nowrap;
      font-size: 0;
      background-color: #bfe6ff;
    }

    #objectpreview {
      width: 100%;
      height: 350px;
      border-radius: 5px;
      pointer-events: none;
    }

    #webbkarta,
    #ruttplanering {
      width: 300px;
    }

    #legend {
      height: 150px;
    }

    #brouter-img {
      max-width: 100%;
    }

    #selectFile {
      max-width: 300px;
    }

    #karta {
      max-width: 300px;
    }

    #defaultZoom {
      max-width: 100px;
    }

    #infoText {
      max-width: 200px;
    }

    #gpxUrl {
      max-width: 300px;
    }

    .link {
      text-decoration: underline;
    }

    #linkCode {
      word-break: break-all;
      white-space: pre-wrap;
      line-break: anywhere;
      padding: 15px 0px 15px 0px;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
  </style>
</head>

<body>
  <header id="kartbild">
    <img src="https://jole84.se/slitlagerkarta/14/8834/4935.jpg">
    <img src="https://jole84.se/slitlagerkarta/14/8835/4935.jpg">
    <img src="https://jole84.se/slitlagerkarta/14/8836/4935.jpg">
  </header>

  <div class="container pt-5">

    <h1>
      Jole84 terräng/vägkarta<br>
    </h1>
    <p class="lead text-muted">Skräddarsydd karta baserad på öppna data från Lantmäteriet (Topografi 50) och vägdata
      från Trafikverket. Enkel webbaserad applikation för navigering utan behov av app-installation samt oberoende av
      operativsystem.</p>
    <a href="https://jole84.github.io/legend.svg"><img id="legend" class="rounded"
        src="https://jole84.github.io/legend.svg"></a><br>
    <hr>

    <a id="linkButton" href="https://jole84.se/nav-app/index.html" class="btn btn-danger my-2">Webbaserad
      navigationsapp</a>
    <a href="https://jole84.se/route-planner/index.html" class="btn btn-warning my-2">jole84 ruttplanerare (beta)</a>
    <a href="https://jole84.github.io/webmap.html" class="btn btn-primary my-2" id="webbkarta">Webbkarta</a>

    <a id="linkButton3" href="https://jole84.se/nav-app/index.html">
      <div>
        <object id="objectpreview" data="https://jole84.se/nav-app/index.html">Your browser doesn’t support the object
          tag.</object>
      </div>
    </a>
    <h4>Start-alternativ:</h4>

    <form onchange="myFunction()" id="theForm">
      <label for="gpxUrl"><b>Ladda GPX-fil automatiskt:</b></label>
      <a href="https://jole84.se/rutter" class="link" target="_blank">(Tillängliga rutter)</a><br>
      <select class="form-select" id="selectFile">
        <option>välj gpxfil</option>
      </select><br>
      <input class="form-control" id="gpxUrl" name="gpxUrl" size="20" placeholder=".gpx"><br>
    </form>

    <!-- <button id="createLink" class="btn btn-primary my-2" onclick="myFunction()">Uppdatera länk</button><br> -->
    <input type="file" id="customFileButton" accept=".gpx,application/gpx+xml" />
    <p><b>Länk för delning:</b><br>
      <code class="user-select-all link" id="linkCode">https://jole84.se/nav-app/index.html</code><br>
    </p>

    <a id="linkButton2" href="https://jole84.se/nav-app/index.html" class="btn btn-danger my-2">Webbaserad
      navigationsapp</a>

    <hr>

    <a href="https://jole84.github.io/brouter-web/index.html" class="btn btn-primary my-2"
      id="ruttplanering">Ruttplanerare</a><br>
    <a href="https://jole84.github.io/brouter-web/index.html"><img id="brouter-img" class="rounded"
        src="https://jole84.github.io/brouter-web.jpg"></a><br>

    <a href="https://jole84.se/html_stuff" class="btn btn-primary my-2" id="ruttplanering">Experiment</a>
    <a href="https://jole84.se/html_stuff/gpx2img.html" class="link" id="gpx2imgLink">GPX2img</a>
    <a href="https://jole84.se/html_stuff/gpx2link.html" class="link">Skapa länk av GPX</a>
    <hr>

    <a href="https://github.com/jole84" class="link">Jole84 Github</a>
  </div>

  <script>
    // const linkUrl = document.getElementById('linkUrl');
    const linkCode = document.getElementById('linkCode');
    const linkButton = document.getElementById('linkButton');
    const gpx2imgLink = document.getElementById('gpx2imgLink');
    const gpxUrl = document.getElementById('gpxUrl');
    const selectFile = document.getElementById('selectFile');
    const customFileButton = document.getElementById("customFileButton");

    var linkUrl = "https://jole84.se/nav-app/index.html"

    customFileButton.addEventListener("change", (evt) => {
      // linkCode
      const files = evt.target.files; // FileList object
      const parser = new DOMParser();
      const poiPoints = [];
      const trackPoints = [];
      let linkText = "";

      const reader = new FileReader();
      reader.readAsText(files[0], "UTF-8");
      reader.onload = function (event) {
        const xmlData = parser.parseFromString(event.target.result, "text/xml");

        const pois = xmlData.getElementsByTagName("wpt");
        for (const poi of pois) {
          const name = poi.childNodes[0].textContent;
          const lon = poi.getAttribute("lon");
          const lat = poi.getAttribute("lat");
          poiPoints.push([[lon, lat], name]);
        }

        const trkpts = xmlData.getElementsByTagName("trkpt");
        for (const trkpt of trkpts) {
          const lon = trkpt.getAttribute("lon");
          const lat = trkpt.getAttribute("lat");
          trackPoints.push([lon, lat]);
        }

        if (trackPoints.length > 0) {
          linkText += "trackPoints=" + JSON.stringify(trackPoints);
        }
        if (poiPoints.length > 0) {
          linkText += "&poiPoints=" + JSON.stringify(poiPoints);
        }
        linkCode.innerHTML = "https://jole84.se/nav-app/index.html?" + linkText;
        linkButton.setAttribute("href", "https://jole84.se/nav-app/index.html?" + linkText);
        linkButton2.setAttribute("href", "https://jole84.se/nav-app/index.html?" + linkText);
        document.getElementById('objectpreview').setAttribute("data", "https://jole84.se/nav-app/index.html?" + linkText);
        gpx2imgLink.setAttribute("href", "https://jole84.se/html_stuff/gpx2img.html?" + linkText);
      }
    });

    function myFunction() {
      for (var i = 0; i < filesList.length; i++) {
        var opt = filesList[i];
        var el = document.createElement("option");
        el.textContent = opt;
        el.value = opt;
        selectFile.appendChild(el);
      }


      var newLinkUrl = linkUrl + '?';

      if (gpxUrl.value) {
        newLinkUrl += gpxUrl.value;
        gpx2imgLink.setAttribute("href", "https://jole84.se/html_stuff/gpx2img.html?" + gpxUrl.value);
      }

      if (selectFile.value != 'välj gpxfil') {
        newLinkUrl += selectFile.value;
        gpx2imgLink.setAttribute("href", "https://jole84.se/html_stuff/gpx2img.html?" + selectFile.value);
      }

      if (newLinkUrl == linkUrl + '?') {
        linkCode.innerHTML = linkUrl;
        linkButton.setAttribute("href", linkUrl);
        linkButton2.setAttribute("href", linkUrl);
        document.getElementById("linkButton3").setAttribute("href", linkUrl);
      } else {
        linkCode.innerHTML = newLinkUrl;
        linkButton.setAttribute("href", newLinkUrl);
        linkButton2.setAttribute("href", newLinkUrl);
        document.getElementById("linkButton3").setAttribute("href", newLinkUrl);
      }
      document.getElementById('objectpreview').setAttribute("data", newLinkUrl);
    }

    myFunction();
  </script>
</body>

</html>